<?php
//=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-||
// Core
// Version 6.0.01
// 2021-02-01
//=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-||


//=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-||
// File
//=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-||

    class File {

        //=====================================================================================================================||
        //===|| Read a File - Should be optimized with Redis
        //=====================================================================================================================||

        static function read($file)	{
            $file = str_replace(array('../', './'), array('',''), $file);
            $fh   = @fopen($file, 'r');
            if (!$fh) return null;
            $fr   = @fread($fh, filesize($file));
            @fclose($fh);
            return($fr);
        }

        //=====================================================================================================================||
        //===|| Write a File
        //=====================================================================================================================||

        static function write($file, $data)						{
            $file 	= str_replace(array('../', './'), array('',''), $file);
            $dir 	= dirname($file);
            $perms	= substr(decoct(fileperms($dir)),3);
            if (!file_exists($dir)) return Core::error('File :: Write :: Directory does not exist :: ' . $dir);
            if ($perms <= 76) 		return Core::error('File :: Write :: Directory is not writable :: ' . $dir);
            $fh = fopen($file, 'w');
            fwrite($fh, $data);
            fclose($fh);
            return($data);
        }

        //=====================================================================================================================||
        //===|| Permissions Check
        //=====================================================================================================================||

        static function permissions($dir)	{
            if (!file_exists($dir) || !is_dir($dir) || substr(decoct(fileperms($dir)),3) <= 76) {
                echo('Making Directory ' . $dir . '<br>');
                if (!file_exists($dir) || !is_dir($dir)) @mkdir($dir);
                if (file_exists($dir) || is_dir($dir)) @chmod($dir, 0777);
                if (!file_exists($dir) || !is_dir($dir) || substr(decoct(fileperms($dir)),3) <= 76)	return Core::error('File :: Permissions :: Directory missing or is not writable :: ' . $dir, true);
            }
        }

        //=====================================================================================================================||
        //===|| Copy a File
        //=====================================================================================================================||

        static function copy($file,$new)			 			{ if (!file_exists($file)) return false; else return copy($file,$new);}

        //=====================================================================================================================||
        //===|| Move a File
        //=====================================================================================================================||

        static function move($file,$new)			 			{ if (!file_exists($file)) return false; else return rename($file,$new);}

        //=====================================================================================================================||
        //===|| Rename a File
        //=====================================================================================================================||

        static function rename($file,$new)			 			{ if (!file_exists($file)) return false; else return rename($file,$new);}

        //=====================================================================================================================||
        //===|| Delete a File
        //=====================================================================================================================||

        static function delete($file)			 				{ if (!file_exists($file)) return false; else return unlink($file);}

        //=====================================================================================================================||
        //===|| File Exists?
        //=====================================================================================================================||

        static function exists($file)			 				{ return (file_exists($file)); }

        //=====================================================================================================================||
        //===|| File modified Date
        //=====================================================================================================================||

        static function modified($file)			 				{ return (file_exists($file)) ? filemtime($file) :  -1;}

        //=====================================================================================================================||
        //===|| Filename
        //=====================================================================================================================||

        static function filename($file) {
            return basename($file) . self::extension($file);
        }

        //=====================================================================================================================||
        //===|| Extension
        //=====================================================================================================================||

        static function extension($file) {
            $info  = pathinfo($file);
            return (isset($info['extension'])) ? str_replace('.', '', strtolower($info['extension'])) : false;
        }

        //=====================================================================================================================||
        //===|| End
        //=====================================================================================================================||

    }

